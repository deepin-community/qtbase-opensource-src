Author: Tian Shilin<tianshilin@uniontech.com>
Date:   Fri Jun 14 10:42:24 2025
Subject:Handle missing charset value in qDecodeDataUrl to avoid assertion
Upstream: https://codereview.qt-project.org/c/qt/qtbase/+/642006

Index: qtbase-opensource-src/src/corelib/io/qdataurl.cpp
===================================================================
--- qtbase-opensource-src.orig/src/corelib/io/qdataurl.cpp
+++ qtbase-opensource-src/src/corelib/io/qdataurl.cpp
@@ -76,10 +76,11 @@ Q_CORE_EXPORT bool qDecodeDataUrl(const
         }
 
         if (data.toLower().startsWith("charset")) {
-            int i = 7;      // strlen("charset")
-            while (data.at(i) == ' ')
-                ++i;
-            if (data.at(i) == '=')
+            int prefixSize = 7; // strlen("charset")
+            QLatin1String copy(data.constData() + prefixSize, data.size() - prefixSize);
+            while (copy.startsWith(QLatin1String(" ")))
+                copy = copy.mid(1);
+            if (copy.startsWith(QLatin1String("=")))
                 data.prepend("text/plain;");
         }
 
